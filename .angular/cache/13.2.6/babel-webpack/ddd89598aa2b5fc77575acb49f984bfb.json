{"ast":null,"code":"import _asyncToGenerator from \"D:\\\\roadcast-web\\\\jfl-tracking\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./googlemap.component.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./googlemap.component.css?ngResource\";\nimport { Component, ViewChild } from '@angular/core';\nimport { OrderService } from \"../order.service\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { interval, Subscription } from \"rxjs\";\nimport SmoothMarker from 'smooth-icon-marker';\nlet GooglemapComponent = class GooglemapComponent {\n  constructor(orderService, http) {\n    this.orderService = orderService;\n    this.http = http;\n    this.options = {\n      zoomControl: true,\n      gestureHandling: 'greedy'\n    };\n    this.coordinates = [];\n    this.markers = [];\n    this.order = {};\n    this.orderHereMapRoutePath = {};\n    this.marker = [];\n    this.sub = new Subscription();\n    this.getData = [];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.orderService.init().then();\n      _this.order = _this.orderService.order;\n\n      _this.mapReady(); // this.dataFirstCall();\n\n    })();\n  }\n\n  mapReady() {\n    const mapOptions = {\n      center: {\n        lat: this.order.delivery_location.latitude,\n        lng: this.order.delivery_location.longitude\n      },\n      zoom: 14,\n      mapTypeId: google.maps.MapTypeId.ROADMAP,\n      disableDefaultUI: true\n    };\n    this.map = new google.maps.Map(this.mapElement.nativeElement, mapOptions);\n    this.pickupLatLng = {\n      lat: this.order.pick_up_location.latitude,\n      lng: this.order.pick_up_location.longitude\n    };\n    this.markers.push(this.pickupLatLng);\n    const pickupMarker = new google.maps.Marker({\n      position: new google.maps.LatLng(this.pickupLatLng.lat, this.pickupLatLng.lng),\n      icon: {\n        url: 'assets/images/store.svg',\n        scaledSize: new google.maps.Size(35, 35) // size\n\n      },\n      title: ''\n    });\n    pickupMarker.setMap(this.map);\n    google.maps.event.addListener(pickupMarker, 'click', () => {\n      const infowindow = new google.maps.InfoWindow({\n        content: 'Pickup'\n      });\n      infowindow.open(this.map, pickupMarker);\n    });\n    this.dropLatLng = {\n      lat: this.order.delivery_location.latitude,\n      lng: this.order.delivery_location.longitude\n    };\n    this.markers.push(this.dropLatLng);\n    const dropMarker = new google.maps.Marker({\n      position: new google.maps.LatLng(this.dropLatLng.lat, this.dropLatLng.lng),\n      icon: {\n        url: 'assets/images/home.svg',\n        scaledSize: new google.maps.Size(35, 35) // size\n\n      },\n      title: ''\n    });\n    dropMarker.setMap(this.map);\n    google.maps.event.addListener(dropMarker, 'click', () => {\n      const infowindow = new google.maps.InfoWindow({\n        content: 'Drop'\n      });\n      infowindow.open(this.map, dropMarker);\n    });\n    this.getRiderPathFromHerePathThenCacheLocally(this.order).then();\n    this.riderLatLng = {\n      lat: this.order.rider_position.latitude,\n      lng: this.order.rider_position.longitude\n    };\n    this.oldRiderLatLng = this.riderLatLng;\n    const riderIcon = {\n      url: 'assets/images/bike.svg',\n      scaledSize: new google.maps.Size(40, 40),\n      rotation: 0\n    };\n    this.riderMarker = new SmoothMarker({\n      map: this.map,\n      icon: riderIcon,\n      title: '',\n      durationMs: 4000,\n      position: new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude)\n    });\n    setTimeout(() => {\n      this.map.panTo(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\n    }, 200);\n    this.sub = interval(4000).subscribe(() => {\n      this.orderService.init().then();\n      this.order = this.orderService.order;\n      this.riderLatLng = {\n        lat: this.order.rider_position.latitude,\n        lng: this.order.rider_position.longitude\n      };\n      const bearing = this.getBearing(this.oldRiderLatLng.lat, this.oldRiderLatLng.lng, this.riderLatLng.lat, this.riderLatLng.lng);\n      const bearingData = Number(bearing.toFixed(0));\n      console.log('old bearing', this.oldBearingData);\n\n      if (bearingData === 0) {\n        this.bikeSvg = this.oldBearingData - this.oldBearingData % 15;\n      } else {\n        this.bikeSvg = bearingData - bearingData % 15;\n        this.oldBearingData = bearingData;\n      }\n\n      const riderIcon = {\n        url: 'assets/images/svg/' + this.bikeSvg + '.svg',\n        scaledSize: new google.maps.Size(40, 40),\n        rotation: bearing\n      };\n      this.riderMarker.setIcon(riderIcon);\n      this.riderMarker.durationMs = 4000;\n      this.riderMarker.animatedSetPosition(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\n      setTimeout(() => {\n        this.map.panTo(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\n      }, 2000);\n      this.oldRiderLatLng = this.riderLatLng;\n    });\n\n    if (this.order.status_name === 'delivered' || this.order.status_name === 'cancelled') {\n      this.sub.unsubscribe();\n    }\n  }\n\n  panMap(newPosition) {\n    setTimeout(() => {\n      this.map.panTo(newPosition);\n    }, 100);\n  }\n\n  radians(n) {\n    return n * (Math.PI / 180);\n  }\n\n  degrees(n) {\n    return n * (180 / Math.PI);\n  }\n\n  getBearing(startLat, startLong, endLat, endLong) {\n    startLat = this.radians(startLat);\n    startLong = this.radians(startLong);\n    endLat = this.radians(endLat);\n    endLong = this.radians(endLong);\n    var dLong = endLong - startLong;\n    var dPhi = Math.log(Math.tan(endLat / 2.0 + Math.PI / 4.0) / Math.tan(startLat / 2.0 + Math.PI / 4.0));\n\n    if (Math.abs(dLong) > Math.PI) {\n      if (dLong > 0.0) dLong = -(2.0 * Math.PI - dLong);else dLong = 2.0 * Math.PI + dLong;\n    }\n\n    return (this.degrees(Math.atan2(dLong, dPhi)) + 360.0) % 360.0;\n  }\n\n  getRiderPathFromHerePathThenCacheLocally(order) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let origin, destination;\n\n      if (order.rider_position && order.rider_position.latitude && order.rider_position.longitude) {\n        origin = [order.rider_position.longitude, order.rider_position.latitude];\n      }\n\n      if (order.delivery_location && order.delivery_location.latitude && order.delivery_location.longitude) {\n        destination = [order.delivery_location.longitude, order.delivery_location.latitude];\n      }\n\n      if (origin && destination) {\n        const request = _this2.http.post('https://routing.roadcast.co.in/ors/v2/directions/driving-car/geojson', {\n          coordinates: [origin, destination]\n        }).subscribe(res => {\n          _this2.coordinates = res.features[0].geometry.coordinates;\n\n          const coordsClean = _this2.coordinates.map(x => {\n            const dataArray = x.slice();\n            return {\n              lat: x[1],\n              lng: x[0]\n            };\n          });\n\n          new google.maps.Polyline({\n            strokeColor: 'blue',\n            map: _this2.map,\n            path: coordsClean,\n            geodesic: true,\n            visible: true\n          });\n        });\n      }\n    })();\n  }\n\n};\n\nGooglemapComponent.ctorParameters = () => [{\n  type: OrderService\n}, {\n  type: HttpClient\n}];\n\nGooglemapComponent.propDecorators = {\n  mapElement: [{\n    type: ViewChild,\n    args: ['map', {\n      static: false\n    }]\n  }]\n};\nGooglemapComponent = __decorate([Component({\n  selector: 'app-googlemap',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], GooglemapComponent);\nexport { GooglemapComponent };","map":{"version":3,"sources":["D:/roadcast-web/jfl-tracking/src/app/googlemap/googlemap.component.ts"],"names":["__decorate","__NG_CLI_RESOURCE__0","__NG_CLI_RESOURCE__1","Component","ViewChild","OrderService","HttpClient","interval","Subscription","SmoothMarker","GooglemapComponent","constructor","orderService","http","options","zoomControl","gestureHandling","coordinates","markers","order","orderHereMapRoutePath","marker","sub","getData","ngOnInit","init","then","mapReady","mapOptions","center","lat","delivery_location","latitude","lng","longitude","zoom","mapTypeId","google","maps","MapTypeId","ROADMAP","disableDefaultUI","map","Map","mapElement","nativeElement","pickupLatLng","pick_up_location","push","pickupMarker","Marker","position","LatLng","icon","url","scaledSize","Size","title","setMap","event","addListener","infowindow","InfoWindow","content","open","dropLatLng","dropMarker","getRiderPathFromHerePathThenCacheLocally","riderLatLng","rider_position","oldRiderLatLng","riderIcon","rotation","riderMarker","durationMs","setTimeout","panTo","subscribe","bearing","getBearing","bearingData","Number","toFixed","console","log","oldBearingData","bikeSvg","setIcon","animatedSetPosition","status_name","unsubscribe","panMap","newPosition","radians","n","Math","PI","degrees","startLat","startLong","endLat","endLong","dLong","dPhi","tan","abs","atan2","origin","destination","request","post","res","features","geometry","coordsClean","x","dataArray","slice","Polyline","strokeColor","path","geodesic","visible","ctorParameters","type","propDecorators","args","static","selector","template","styles"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport __NG_CLI_RESOURCE__0 from \"./googlemap.component.html?ngResource\";\r\nimport __NG_CLI_RESOURCE__1 from \"./googlemap.component.css?ngResource\";\r\nimport { Component, ViewChild } from '@angular/core';\r\nimport { OrderService } from \"../order.service\";\r\nimport { HttpClient } from \"@angular/common/http\";\r\nimport { interval, Subscription } from \"rxjs\";\r\nimport SmoothMarker from 'smooth-icon-marker';\r\nlet GooglemapComponent = class GooglemapComponent {\r\n    constructor(orderService, http) {\r\n        this.orderService = orderService;\r\n        this.http = http;\r\n        this.options = {\r\n            zoomControl: true,\r\n            gestureHandling: 'greedy',\r\n        };\r\n        this.coordinates = [];\r\n        this.markers = [];\r\n        this.order = {};\r\n        this.orderHereMapRoutePath = {};\r\n        this.marker = [];\r\n        this.sub = new Subscription();\r\n        this.getData = [];\r\n    }\r\n    async ngOnInit() {\r\n        await this.orderService.init().then();\r\n        this.order = this.orderService.order;\r\n        this.mapReady();\r\n        // this.dataFirstCall();\r\n    }\r\n    mapReady() {\r\n        const mapOptions = {\r\n            center: {\r\n                lat: this.order.delivery_location.latitude,\r\n                lng: this.order.delivery_location.longitude,\r\n            },\r\n            zoom: 14,\r\n            mapTypeId: google.maps.MapTypeId.ROADMAP,\r\n            disableDefaultUI: true,\r\n        };\r\n        this.map = new google.maps.Map(this.mapElement.nativeElement, mapOptions);\r\n        this.pickupLatLng = {\r\n            lat: this.order.pick_up_location.latitude,\r\n            lng: this.order.pick_up_location.longitude,\r\n        };\r\n        this.markers.push(this.pickupLatLng);\r\n        const pickupMarker = new google.maps.Marker({\r\n            position: new google.maps.LatLng(this.pickupLatLng.lat, this.pickupLatLng.lng),\r\n            icon: {\r\n                url: 'assets/images/store.svg',\r\n                scaledSize: new google.maps.Size(35, 35), // size\r\n            },\r\n            title: '',\r\n        });\r\n        pickupMarker.setMap(this.map);\r\n        google.maps.event.addListener(pickupMarker, 'click', () => {\r\n            const infowindow = new google.maps.InfoWindow({\r\n                content: 'Pickup'\r\n            });\r\n            infowindow.open(this.map, pickupMarker);\r\n        });\r\n        this.dropLatLng = {\r\n            lat: this.order.delivery_location.latitude,\r\n            lng: this.order.delivery_location.longitude,\r\n        };\r\n        this.markers.push(this.dropLatLng);\r\n        const dropMarker = new google.maps.Marker({\r\n            position: new google.maps.LatLng(this.dropLatLng.lat, this.dropLatLng.lng),\r\n            icon: {\r\n                url: 'assets/images/home.svg',\r\n                scaledSize: new google.maps.Size(35, 35), // size\r\n            },\r\n            title: ''\r\n        });\r\n        dropMarker.setMap(this.map);\r\n        google.maps.event.addListener(dropMarker, 'click', () => {\r\n            const infowindow = new google.maps.InfoWindow({\r\n                content: 'Drop'\r\n            });\r\n            infowindow.open(this.map, dropMarker);\r\n        });\r\n        this.getRiderPathFromHerePathThenCacheLocally(this.order).then();\r\n        this.riderLatLng = {\r\n            lat: this.order.rider_position.latitude,\r\n            lng: this.order.rider_position.longitude,\r\n        };\r\n        this.oldRiderLatLng = this.riderLatLng;\r\n        const riderIcon = {\r\n            url: 'assets/images/bike.svg',\r\n            scaledSize: new google.maps.Size(40, 40),\r\n            rotation: 0\r\n        };\r\n        this.riderMarker = new SmoothMarker({\r\n            map: this.map,\r\n            icon: riderIcon,\r\n            title: '',\r\n            durationMs: 4000,\r\n            position: new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude),\r\n        });\r\n        setTimeout(() => {\r\n            this.map.panTo(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\r\n        }, 200);\r\n        this.sub = interval(4000)\r\n            .subscribe(() => {\r\n            this.orderService.init().then();\r\n            this.order = this.orderService.order;\r\n            this.riderLatLng = {\r\n                lat: this.order.rider_position.latitude,\r\n                lng: this.order.rider_position.longitude,\r\n            };\r\n            const bearing = this.getBearing(this.oldRiderLatLng.lat, this.oldRiderLatLng.lng, this.riderLatLng.lat, this.riderLatLng.lng);\r\n            const bearingData = Number(bearing.toFixed(0));\r\n            console.log('old bearing', this.oldBearingData);\r\n            if (bearingData === 0) {\r\n                this.bikeSvg = this.oldBearingData - (this.oldBearingData % 15);\r\n            }\r\n            else {\r\n                this.bikeSvg = bearingData - (bearingData % 15);\r\n                this.oldBearingData = bearingData;\r\n            }\r\n            const riderIcon = {\r\n                url: 'assets/images/svg/' + this.bikeSvg + '.svg',\r\n                scaledSize: new google.maps.Size(40, 40),\r\n                rotation: bearing\r\n            };\r\n            this.riderMarker.setIcon(riderIcon);\r\n            this.riderMarker.durationMs = 4000;\r\n            this.riderMarker.animatedSetPosition(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\r\n            setTimeout(() => {\r\n                this.map.panTo(new google.maps.LatLng(this.order.rider_position.latitude, this.order.rider_position.longitude));\r\n            }, 2000);\r\n            this.oldRiderLatLng = this.riderLatLng;\r\n        });\r\n        if (this.order.status_name === 'delivered' || this.order.status_name === 'cancelled') {\r\n            this.sub.unsubscribe();\r\n        }\r\n    }\r\n    panMap(newPosition) {\r\n        setTimeout(() => {\r\n            this.map.panTo(newPosition);\r\n        }, 100);\r\n    }\r\n    radians(n) {\r\n        return n * (Math.PI / 180);\r\n    }\r\n    degrees(n) {\r\n        return n * (180 / Math.PI);\r\n    }\r\n    getBearing(startLat, startLong, endLat, endLong) {\r\n        startLat = this.radians(startLat);\r\n        startLong = this.radians(startLong);\r\n        endLat = this.radians(endLat);\r\n        endLong = this.radians(endLong);\r\n        var dLong = endLong - startLong;\r\n        var dPhi = Math.log(Math.tan(endLat / 2.0 + Math.PI / 4.0) / Math.tan(startLat / 2.0 + Math.PI / 4.0));\r\n        if (Math.abs(dLong) > Math.PI) {\r\n            if (dLong > 0.0)\r\n                dLong = -(2.0 * Math.PI - dLong);\r\n            else\r\n                dLong = (2.0 * Math.PI + dLong);\r\n        }\r\n        return (this.degrees(Math.atan2(dLong, dPhi)) + 360.0) % 360.0;\r\n    }\r\n    async getRiderPathFromHerePathThenCacheLocally(order) {\r\n        let origin, destination;\r\n        if (order.rider_position &&\r\n            order.rider_position.latitude && order.rider_position.longitude) {\r\n            origin = [order.rider_position.longitude, order.rider_position.latitude];\r\n        }\r\n        if (order.delivery_location &&\r\n            order.delivery_location.latitude &&\r\n            order.delivery_location.longitude) {\r\n            destination = [\r\n                order.delivery_location.longitude,\r\n                order.delivery_location.latitude,\r\n            ];\r\n        }\r\n        if (origin && destination) {\r\n            const request = this.http.post('https://routing.roadcast.co.in/ors/v2/directions/driving-car/geojson', {\r\n                coordinates: [\r\n                    origin, destination,\r\n                ],\r\n            }).subscribe((res) => {\r\n                this.coordinates = res.features[0].geometry.coordinates;\r\n                const coordsClean = this.coordinates.map((x) => {\r\n                    const dataArray = x.slice();\r\n                    return { lat: x[1], lng: x[0] };\r\n                });\r\n                new google.maps.Polyline({ strokeColor: 'blue',\r\n                    map: this.map,\r\n                    path: coordsClean, geodesic: true, visible: true,\r\n                });\r\n            });\r\n        }\r\n    }\r\n};\r\nGooglemapComponent.ctorParameters = () => [\r\n    { type: OrderService },\r\n    { type: HttpClient }\r\n];\r\nGooglemapComponent.propDecorators = {\r\n    mapElement: [{ type: ViewChild, args: ['map', { static: false },] }]\r\n};\r\nGooglemapComponent = __decorate([\r\n    Component({\r\n        selector: 'app-googlemap',\r\n        template: __NG_CLI_RESOURCE__0,\r\n        styles: [__NG_CLI_RESOURCE__1]\r\n    })\r\n], GooglemapComponent);\r\nexport { GooglemapComponent };\r\n"]},"metadata":{},"sourceType":"module"}